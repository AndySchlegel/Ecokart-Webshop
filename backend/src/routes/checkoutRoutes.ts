// ============================================================================
// ğŸ’³ CHECKOUT ROUTES - Stripe Payment Endpoints
// ============================================================================
// Definiert alle Routen fÃ¼r Stripe Checkout Integration.
//
// ğŸ“Œ ENDPOINTS:
//
// POST   /api/checkout
//   - Erstellt Stripe Checkout Session
//   - Auth: Required (JWT Token)
//   - Body: (leer - Cart wird aus DB geholt)
//   - Response: { url: "https://checkout.stripe.com/..." }
//
// GET    /api/checkout/session/:sessionId
//   - Holt Checkout Session Details (fÃ¼r Success Page)
//   - Auth: Required (JWT Token)
//   - Response: { id, amount_total, payment_status, ... }
//
// ============================================================================

import { Router } from 'express';
import { createCheckoutSession, getCheckoutSession } from '../controllers/checkoutController';
import { requireAuth } from '../middleware/cognitoJwtAuth';

const router = Router();

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// MIDDLEWARE: Alle Checkout Routes erfordern Authentication
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ’¡ User muss eingeloggt sein um zur Kasse zu gehen
// requireAuth Middleware prÃ¼ft Cognito JWT Token
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

router.use(requireAuth);

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// POST /api/checkout
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// Erstellt Stripe Checkout Session aus User's Cart.
//
// ğŸ’¡ ABLAUF:
// 1. User klickt "Zur Kasse" im Frontend
// 2. Frontend ruft POST /api/checkout auf
// 3. Backend erstellt Stripe Session
// 4. Frontend leitet zu session.url weiter (Stripe Checkout Page)
// 5. User zahlt auf Stripe-Seite
// 6. Nach Erfolg: Redirect zu Success Page
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

router.post('/', createCheckoutSession);

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// GET /api/checkout/session/:sessionId
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// Holt Details einer abgeschlossenen Checkout Session.
//
// ğŸ’¡ VERWENDUNG:
// - Auf Success Page nach erfolgreicher Zahlung
// - Zeigt BestellbestÃ¤tigung mit Betrag, Email, etc.
// - Kann auch Order ID anzeigen (nachdem Webhook Order erstellt hat)
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

router.get('/session/:sessionId', getCheckoutSession);

export default router;
